!function(a,b,c){function d(a,b){var c,d,e=u[a];e&&(c=e.initial,d=e.events,c&&g(b).H(c),d&&g(b).removeAttr("h-com").H(e.component||a,e.elements,d))}var e=function(a){return document.createElement(a)},f=b([]),g=function(a){return f[0]=a,f},h=document.body,i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"},j=i[Modernizr.prefixed("transition")];a("#css3.plugin").core(function(){return this.plugin("css3",{transEndEventName:j}),this.passing}).one(!0),a("#css3.transition").core(function(){return _.extend(this.css3,{transitionEnd:function(a,b){j?g(a).on(j,function c(){var d=g(a);d.is(this)&&(d.off(j,c),b.call(a))}):b.call(a)}}),this.passing}).required(["#css3.plugin"]).one(!0),a("@css3").queue(["#css3.transition"]),a("#cover").core(function(){var a,b=this,c=this.css3.transEndEventName;return a=e("div"),a.id="full-cover",a.className="fade",a.style.display="none",h.appendChild(a),this.plugin("cover",{pop:function(){g(a).show(),c&&a.offsetWidth,a.className="fade in"},fade:function(){g(a).removeClass("in"),b.css3.transitionEnd(a,function(){g(this).hide()})}}),this.passing}).required(["@css3"]).one(!0),a("#modal").core(function(){function c(){g(document).on("keydown.modal.hcx",function(a){27===a.which&&k.modal.fade(),d()})}function d(){g(document).off("keydown.modal.hcx")}var f=e("div"),i=e("div"),j=e("div"),k=this,l=this.css3.transEndEventName;return f.className="modal fade",f.style.display="none",f.id="modal",i.className="modal-dialog",j.className="modal-content",i.appendChild(j),f.appendChild(i),h.appendChild(f),g(f).on("click.modal.hcx",".modal-close",function(a){k.modal.fade()}),this.plugin("modal",{pop:function(){return k.cover.pop(),g(f).show(),l&&f.offsetWidth,c(),g(f).addClass("in"),this},fade:function(){return a("#modal").trigger("fade"),k.cover.fade(),g(f).removeClass("in"),k.css3.transitionEnd(f,function(){g(this).hide(),a("#modal").trigger("faded")}),d(),this},width:function(a){return g(i).width(a),this},content:function(c){var d=b(c);return a.scan(d),i.style.width=null,g(j).empty().append(d),this}}),this.passing}).required(["#cover"]).one(!0),a("#modal.show").core(function(){this.modal.pop()}).required(["#modal"]),a("#alert").core(function(){var b=a.template(document.getElementById("alert").innerHTML),c=this;return this.plugin("alert",function(a,d){c.modal.content(b({message:a})).width(500).pop()}),this.passing}).required(["#modal"]).one(!0);var k,l=g(document.getElementById("confirm")).html();a("$confirm").core(function(b){var c=this;k||(k=document.getElementById("modal")),this.modal.content(l).width(400).pop(),a("#modal").once("faded",function(){g(k).hasClass("confirmed")?(g(k).removeClass("confirmed"),b()):c.cut()}),g(k).on("click.confirm.hcx",".confirm-button",function(){g(k).addClass("confirmed"),c.modal.fade()})}).required("#modal");var m={baseUrl:"/public/",uploadUrl:"/public/uploads/",uploadJs:"js/third-part/plupload/plupload.full.min.js",uploadSwfUrl:"js/third-part/plupload/Moxie.swf",uploadXapUrl:"js/third-part/plupload/Moxie.xap",uploadTypes:{images:{title:"图片文件",extensions:"png,gif,jpg,jpeg"}},switches:{audit:{text:["通过审核","拒绝审核"],replaced:"{$action}",replacer:["allow","refuse"],classes:["audit-allow","audit-refuse"]},complaints:{text:["已处理","未处理"]},turn:{text:["开启","关闭"],replaced:"{$switch}",replacer:[0,1]}},templates:{"modal-form":"tpl/form.tpl",time:"tpl/time.tpl"},editor:{root:"js/third-part/ue/",style:"themes/default/css/ueditor.min.css",js:["ueditor.config.js","ueditor.all.min.js","lang/zh-cn/zh-cn.js"]},timepicker:{text:{prev:{month:"上一个月"},next:{month:"下一个月"},days:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],shortDays:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortMonths:["一","二","三","四","五","六","七","八","九","十","十一","十二"],today:"今天",confirm:"确定"},defaults:{yearRange:[2013,2016],format:"yyyy-mm-dd"}}};a("#ajax").core(function(){this.register("ajax",{then:function(a,c){return b.ajax(a,c)}})}).pack(),a("$ajax").core(function(a){b.ajax(this.passing).then(function(b){a(b)})}),a("#ajax.api").core(function(){var a=this.passing;return a.result?a:(this.backup&&this.backup.api?this.jump(this.backup.api):(this.alert(a.message),this.cut()),a)}),a("@api").queue(["$ajax","#ajax.api"]).required(["#alert"]),a("#form.modal.template").core(function(){return this.follow("$ajax"),{url:m.baseUrl+m.templates["modal-form"],cache:!0}}).one(!0),a("#form.modal").core(function(){function c(){d={fields:[],title:!1}}var d,e=a.template(this.passing);c(),this.plugin("modal-form",function(a){var c=b(e(a));return this.modal.content(c).pop(),this.form=c,c.attr("action")&&(this.follow("@form.modal"),_.assume(this,"backup",{}).api="@form.modal"),this})}).one(!0).required(["#modal","#form.modal.template"]).one(!0),a("#form.modal.process").core(function(){var a=_.clone(g(this.element).data("form")),b=g(this.target).data("form"),c=g(this.target).data("remote")||a.remote;return _.each(b,function(b,c){"fields"===c?a[c]=a[c].concat(b):a[c]=b}),this["form-modal-data"]=a,c?(this.follow("$ajax"),c):!1}),a("#form.modal.render").core(function(){var a=this["form-modal-data"],b=_(a.fields);_.each(this.passing,function(a,c){var d=c.replace(/\_(\w)/,function(a,b){return b.toUpperCase()}),e=b.find({name:d});e&&(e.value=a)}),this["modal-form"](a)}),a("#form.modal.success").core(function(){window.location.reload()}).required("#alert"),a("@form.modal").queue(["@form","#form.modal.success"]),a("!form.modal").queue(["#form.modal","#form.modal.process","#form.modal.render"]).single(),a("#preview.init").core(function(){return g(this.target).data("remote")}),a("#preview").core(function(){var b=g(this.element).data("preview")||{},c=g(this.target).data("preview")||{},d=c.template||b.template,e=_.assume(this,"template",{}),f=e[d];return f||(console.log(d),f=e[d]=a.template(document.getElementById(d).innerHTML),this.plugin("template",e)),this.preview=f,this.passing}),a("#preview.pop").core(function(){this.modal.content(this.preview(this.passing)).pop()}),a("!preview").queue(["#preview.init","$ajax","#preview","#preview.pop"]).required(["#modal"]),a("#preview.img").core(function(){var b,c=g(this.target),d=_.assume(a.Namespace("tpls.hcx")(),"preview.img",a.template('<div class="preview-container"><div class="close modal-close">&times;</div><a class="preview-img" href="{{url}}" target="_blank"><img src="{{url}}" /></a></div>'));c.hasClass("disable")||(b=m.uploadUrl+c.data("preview").url,this.modal.content(d({url:b})).pop())}).required(["#modal"]).pack(),a("#scroll.register").core(function(){var a=20;return this.plugin("scroll",{init:function(a){var b,c,d=g(a);d.data("scroll.hcx")||(b=e("hcx-rail"),c=e("hcx-handler"),b.appendChild(c),d.append(b),d.data("scroll.hcx",{rail:b,handler:c}),this.update(a))},destory:function(a){var b=g(a),c=b.data("scroll.hcx");c.rail.remove(),b.removeData("scroll.hcx")},update:function(a){var b,c,d,f,h,i,j,k=g(a),l="x"===k.data("scroll")?"x":"y",m="y"===l,n=l?"height":"width",o=k.data("scroll.hcx"),p=o.rail,q="scroll"+(m?"Top":"Left"),r=0;k[q](0),g(p).remove(),p=e("hcx-rail"),i=e("hcx-handler"),p.appendChild(i),k=g(a),k.append(p),o.rail=p,o.handler=i,o.direction&&o.direction!==l?k.removeClass("ui-scroll-"+o.direction).addClass("ui-scroll-"+l):o.direction||(k.addClass("ui-scroll ui-scroll-"+l),"static"===k.css("position")&&k.css("position","relative"),o.scrollMethod=q),o.scrollMethod=q,o.direction=l,o.vertical=m,o.pagePosition=m?"pageY":"pageX",b=a["scroll"+(m?"Height":"Width")],c=k[n](),d=b-c,j=o.percent=r/d,0>=d?(k.addClass("ui-scroll-hidden"),o.scroll=!1):(o.scroll=!0,k.removeClass("ui-scroll-hidden"),f=c*(c/b),h=c-f,g(i)[n](f).css({top:h*j}),g(p)[n](b),_.extend(o,{scroll:!0,scrollSize:b,visibleSize:c,hiddenSize:d,handlerSize:f,handlerSpace:h,scrolled:r}))},move:function(a,b){var c,d,e=g(b),f=e.data("scroll.hcx"),h=f.scrolled,i=f.hiddenSize;d=h+a,d>i?d=i:0>d&&(d=0),f.percent=c=d/i,f.scrolled=d,e[f.scrollMethod](d),g(f.handler).css("top",d+f.handlerSpace*c)},forward:function(b){this.move(a,b)},backward:function(b){this.move(-a,b)}}),this.passing}).one(!0),a("#scroll.init").core(function(){this.scroll.init(this.element)}).required(["#scroll.register"]).pack(),a("#scroll").core(function(){function a(a){a.preventDefault(),a.stopImmediatePropagation(),g(h).off("selectstart.scroll").off("mousemove.scroll")}function b(a){var b=a[k];a.preventDefault(),a.stopImmediatePropagation(),l.scroll.move((b-c)/(i.handlerSpace/i.hiddenSize),j),c=b}var c,d=this.event,e=d.target,f=d.type,i=g(e).closest(".ui-scroll").data("scroll.hcx"),j=g(e).closest(".ui-scroll")[0],k=i.pagePosition,l=this;if("mousedown"===f&&"hcx-handler"===e.tagName.toLowerCase())c=d[k],g(h).one("mouseup.scroll",a).on("selectstart.scroll",function(a){a.preventDefault()}).on("mousemove.scroll",b);else{if("mousewheel"!==f)return;d.originalEvent.wheelDelta>0?this.scroll.backward(j):this.scroll.forward(j)}d.preventDefault(),d.stopPropagation()}).required(["#scroll.register"]).pack(),a("#select.register").core(function(){function c(a){return a.map(function(){return g(this).data("value")}).toArray()}function d(a){return a.hasClass("ui-select-default")?"请选择"+a.text():h({arr:a.map(function(){return g(this).text()})})}var e=this,f=a.template('<li data-value="{{value}}">{{title}}</li>'),h=a.template("已选择“{{each arr as title index}}{{if index == arr.length - 1 && index < 4}}{{title}}”{{elseif index < 3}}{{title}}, {{elseif index == 4}}{{title}}”等{{/if}}{{/each}}{{arr.length}}项");return this.plugin("select",{init:function(a){var b=g(a),e=b.find(".selected"),f=e.data("value"),h=b.hasClass("ui-select-multiple");e.length||(e=b.find(".ui-select-default")),h?(g(a).find(".ui-select-title").text(d(e)),g(a).find("input").val(c(e))):(b.find(".ui-select-title").text(e.first().text()),b.data("value",f).find("input").val(f))},open:function(b){var c=g(b),d=c.data("initialed.select.hcx");d||(c.data("initialed.select.hcx",!0),a.connect("scroll",c.find(".ui-select-options")[0])),g(b).addClass("ui-select-open"),g(document).on("mouseup.bg.select",function(a){g(a.target).closest(b).length||(g(b).removeClass("ui-select-open"),g(document).off("mouseup.bg.select"))})},close:function(a){return g(a).removeClass("ui-select-open"),g(document).off("mouseup.bg.select"),this},toggle:function(a){var b=g(a),c=b.hasClass("ui-select-open")?"close":"open";return this[c](a),this},append:function(a,b){var c;return c=_.reduce(b,function(a,b){return a+f(b)},""),g(a).find(".ui-select-options").append(c),this.update(a),this},slice:function(a,c,d){var e=[c];return 3===arguments.length&&e.push(d),b.fn.slice.apply(g(a).find(".ui-select-options").children("li"),e).remove(),this},update:function(a){var b=g(a).find(".ui-select-options");this.init(a),e.scroll[b.data("scroll.hcx")?"update":"init"](b[0])},change:function(a){var b,e,f,h=a.parentNode.parentNode,i=g(h).hasClass("ui-select-multiple");return i?(g(a).toggleClass("selected"),b=g(h).find(".selected"),b.length||(b=g(h).find(".ui-select-default")),g(h).find(".ui-select-title").text(d(b)),g(h).find("input").val(c(b))):(b=g(h).data("selected.hcx")||g(a).siblings(".selected")[0],g(h).data("selected.hcx",a),e=g(a),e.is(b)||(e.addClass("selected"),f=e.data("value"),e.parent().prev().text(e.text()).prev().val(e.data("value")),b&&g(b).removeClass("selected"),g(h).data("value",f),g(h).find("input").trigger("change")),this.close(h)),this},hover:function(a){return g(a).addClass("hover"),this},"default":function(a,b){g(a).find(".ui-select-default").text(b)}}),this.passing}).required(["#scroll.register"]).one(!0),a("#select").core(function(){var a=this.event,b=a.target;g(b).hasClass("ui-select-title")?this.select.toggle(b.parentNode):"li"===b.tagName.toLowerCase()&&this.select.change(b)}).required(["#select.register"]).pack(),a("#select.init").core(function(){var a=this;g(this.element).find(".ui-select").addBack(".ui-select").each(function(b,c){a.select.init(c)})}).required(["#select.register"]).pack();var n,p,q=/\s+/;a("$upload.load").core(function(a){b.ajax(m.baseUrl+m.uploadJs,{cache:!0,dataType:"script",charset:"UTF-8"}).done(a)}).after(function(){var a=this;p={crop:!0,swf_url:o.resolveUrl(m.baseUrl+m.uploadSwfUrl),xap_url:o.resolveUrl(m.baseUrl+m.uploadXapUrl)},plupload.addFileFilter("min_size",function(b,c,d){var e=new o.Image,f="图片选择错误：";e.bind("load",function(){var c=!0,e=b.width,g=b.height;e&&(c=this.width>=e,c||g||(f+="图片宽度不能小于："+e+"像素")),g&&(c=this.height>=g,c||e||(f+="图片高度不能小于："+g+"像素")),!c&&e&&g&&(f+="图片尺寸不能小于：宽"+e+"像素&times;高"+g+"像素"),c||a.alert(f),d(c)}),e.load(c.getSource())})}).required("#alert").one(!0),a("#upload.initial").core(function(){function a(a,b){c.bind(a,function(){var a=_(arguments).unshift(c.id+"."+b,e.element).value();n.triggerWith.apply(n,a)})}var b,c,d=g(this.element),e=this,f=d.find(".upload-button"),h=d.data("upload"),i=h.type,j=h.size,k=h.multi_selection,l=h.max_count,o={runtimes:"html5,flash,silverlight,html4",browse_button:[].slice.call(f),resize:j?{crop:!0,width:j.width,height:j.height,preserve_headers:!1}:{crop:!1,preserve_headers:!1},filters:{max_count:l,min_size:h.min_size},flash_swf_url:m.baseUrl+m.uploadSwfUrl,silverlight_xap_url:m.baseUrl+m.uploadXapUrl,prevent_duplicates:!0};k&&l&&this.follow("!upload.max_count"),i&&("string"==typeof i&&(i=[i]),o.filters.mime_types=_.map(i,function(a){return m.uploadTypes[a]})),b=_.extend(o,h),c=new plupload.Uploader(b),d.data("uploader.hcx",c),c.init(),a("FilesAdded","added.upload"),a("UploadProgress","progress.upload"),a("Error","error.upload"),a("UploadComplete","complete.upload"),a("UploadProgress","progress.upload"),a("FileUploaded","uploaded.upload"),a("BeforeUpload","before.upload"),a("FileFiltered","filtered.upload"),n.on("error.upload",function(){e.alert("上传出错!")})}),n=a("!upload").queue(["$upload.load","#upload.initial"]),a("#upload-image").core(function(){function a(a){return(a/1e3).toFixed(1)+"KB"}function c(b,c){j===b.id&&g(this).find(".upg-info").text(a(c.loaded)+"/"+a(c.size)).next().width(c.percent+"%")}var d=this,e=this.element,f=g(e),h=f.data("upload"),i=_.extend({},p),j=f.data("uploader.hcx").id;i.height=203,h.size?i.width=203*(h.size.width/h.size.height):i.width=203,f.find(".upload-button").each(function(){var a=g(this),b=a.find(".upload-field").val();a.width(i.width),b&&(a.find(".upload-preview").addClass("shown").find(".upload-preview-img").attr("src",m.uploadUrl+b),e.offsetWidth,a.addClass("inited").next().find(".preview-img").removeClass("disable").data("preview",{url:b}))}),n.on(j+".added.upload",function(a,b){var c=new o.Image,d=b[0],e=g(this).find(".upload-preview-container").empty()[0];c.bind("load",function(){this.embed(e,i)}),c.bind("embedded",function(){this.destroy(),a.start()}),c.load(d.getSource())}),n.on(j+".before.upload",function(a,b){g(this).find(".upload-preview").addClass("uploading shown"),c.call(this,a,b)}),n.on(j+".progress.upload",c),n.on(j+".uploaded.upload",function(a,c,e){var f=b.parseJSON(e.response);a.removeFile(c),f.result?(g(this).find(".upload-field").val(f.file).end().find(".upload-preview").addClass("uploaded").removeClass("uploading").find(".upload-preview-progress").finish().delay(1500).fadeOut(500,function(){g(this).removeAttr("style").find(".upg-bar").removeAttr("style").end().parent().removeClass("uploaded")}),g(this).find(".preview-img").removeClass("disable").data("preview",{url:f.file})):(d.alert(f.message),g(this).find(".upload-preview").addClass("error").find(".upg-info").text(f.message))})}).required(["!upload","#alert"]).pack(),a("#upload-images.init").core(function(){a.Namespace("tpls.hcx")("upload-images.item",a.template('{{each list img}}<li{{if img.id}} class="upload-existed" id="upload-images-preview-{{img.id}}"{{else}} class="uploading"{{/if}}>{{if !img.id}}<input class="upload-field" type="hidden" name="{{name}}" value="{{img.id}}" />{{/if}}<div class="gfs-preview-container"><a class="gfs-preview-delete delete"></a><div class="gfs-preview-embed">{{if img.url}}<img class="gfs-preview-img" src="{{base}}{{img.url}}" />{{/if}}</div><div class="upload-preview-progress"><div class="upg-info"></div><div class="upg-bar"></div></div></div>{{if cover}}<div class="gfs-cover"><div class="ui-radio{{if img.id == cover.selected}} ui-checked{{/if}}"><input class="ui-field" name="{{cover.name}}" value="{{img.id}}" type="radio"{{if img.id == cover.selected}} checked{{/if}} /><div class="ui-beacon-on">ON</div><div class="ui-beacon-off">OFF</div></div><span>设为封面</span></div>{{/if}}</li>{{/each}}'))}).required("!upload").one(!0),a("#upload.max_count").core(function(){plupload.addFileFilter("max_count",function(b,c,d){var e=a.Namespace("uploaded.hcx")();d(this.files.length+e.existed<b)})}).pack().one(!0),a("#upload-images").core(function(){function c(a){s>a.height/a.width?(t.width=r,t.height=q*s):(t.width=r*s,t.height=q)}function d(a){return(a/1e3).toFixed(1)+"KB"}var e,f=a.Namespace("tpls.hcx")("upload-images.item"),h=this.element,i=g(h),j=i.find(".gfs-preview-list"),k=i.data("upload"),l=i.data("uploader.hcx"),m=k.data,q=132,r=200,s=q/r,t=_.extend({},p);e=a.Namespace("uploaded.hcx"),e("existed",k.data.list.length),j.append(f(m)),n.on(l.id+".added.upload",function(a,d){function e(){if(g!==d.length){var h,i=new o.Image,k=d[g];h=b(f(_.defaults({list:[{}]},m))).appendTo(j),l.refresh(),h.attr("id","upload-images-preview-"+k.id).data("id.upload.hcx",k.id),i.bind("load",function(){this.embed(h.find(".gfs-preview-embed")[0],c(i))}),i.bind("embedded",function(){this.destroy(),g++,e()}),i.load(k.getSource()),setTimeout(function(){a.start()},10)}}if(l.id===a.id){var g=0;e()}}),n.on(l.id+".progress.upload",function(a,c){b("#upload-images-preview-"+c.id).find(".upg-info").text(d(c.loaded)+"/"+d(c.size)).next().width(c.percent+"%")}),n.on(l.id+".uploaded.upload",function(a,c,d){if(l.id===a.id){var e=b.parseJSON(d.response);e.result?(b("#upload-images-preview-"+c.id).addClass("uploaded").removeClass("uploading").find(".upload-field,.ui-field").val(e.id).end().find(".upload-preview-progress").finish().delay(1500).fadeOut(500,function(){g(this).removeAttr("style").find(".upg-bar").removeAttr("style").closest("li").removeClass("uploaded")}),g(this).find(".preview-img").removeClass("disable").data("preview",{url:e.file})):b("#upload-images-preview-"+c.id).addClass("error").find(".upg-info").text(e.message)}})}).required("#upload-images.init").pack(),a("#upload.delete").core(function(){var b=this.element,c=g(b),d=c.data("upload"),e=c.data("uploader.hcx"),f=g(this.target).closest("li"),h=a.Namespace("uploaded.hcx")(),i=f.data("id.upload.hcx");f.hasClass("upload-existed")?(h.existed=h.existed-1,f.removeClass("upload-existed"),i=f.attr("id").split("-").pop(),g(b).append('<input type="hidden" name="{name}" value="{id}" />'.replace("{id}",i).replace("{name}",d.data["remove-name"]))):i&&e.removeFile(i)}).pack(),a("#time-panel").core(function(){var a,b,c=(this.time,g(this.element).data("time.hcx")),d=g(this.element).data("picked.time.hcx"),e=g(this.event.target);e.hasClass("timepicker-prev-month")?(a=c.getUTCMonth()-1,0>a?(c.setUTCMonth(11),c.setUTCFullYear(c.getUTCFullYear()-1)):c.setUTCMonth(a)):e.hasClass("timepicker-next-month")?c.setUTCMonth(c.getUTCMonth()+1):e.hasClass("timepicker-month-picker")?c.setUTCMonth(e.data("value")):e.hasClass("timepicker-year-picker")?c.setUTCFullYear(e.data("value")):e.hasClass("timepicker-today")?(d.setTime(+new Date),this.time.pick(),g(this.element).find(".timepicker-days-picked").removeClass("timepicker-days-picked").end().find(".timepicker-days-today").addClass("timepicker-days-picked")):e.hasClass("timepicker-days")?(a=c.getUTCMonth(),b=c.getUTCFullYear(),e.hasClass("timepicker-days-next")?a+=1:e.hasClass("timepicker-days-prev")&&(a-=1,0>a&&(a=11,b-=1)),d.setUTCFullYear(b),d.setUTCMonth(a),d.setUTCDate(+e.text()),this.time.pick(),e.siblings(".timepicker-days-picked").removeClass("timepicker-days-picked").end().addClass("timepicker-days-picked")):e.hasClass("timepicker-confirm")&&(this.time.fade(),this.time.change()),this.time.update()}).required("#time.plugin").pack(),a("#time.template").core(function(){return this.follow("$ajax"),{url:m.baseUrl+m.templates.time,cache:!0}}).one(!0),a("#time.plugin").core(function(){function c(a){var b,c=D[a],d=0;if(c)return c;for(c=[];b=B.exec(a);)c.push(a.slice(d,b.index),b[0]),d=b.index+b[0].length;return d<a.length&&c.push(a.slice(d,a.length)),D[a]=c,c}function d(a,b){if(!a)return new Date;var d=c(b),e=d.length,f=new Date(0,0,0,0,0,0,0),g=0;return _.each(d,function(b,c){var h,i;c%2===0&&c?(h=a.indexOf(b,g),i=a.slice(g,h),g=h+b.length,z[d[c-1]](f,i)):c%2&&c+1===e&&(i=a.slice(g),z[d[c]](f,i))}),f}function e(a,b){var d=c(b);return _.map(d,function(b,c){return c%2?A[b](a):b}).join("")}function f(a,b){return new Date(a,b+1,0).getDate()}function i(a){var c,d,e,g,h,i=new Date(+a),j=i.getUTCFullYear(),k=i.getUTCMonth(),l=[],m=v.getUTCMonth()===k&&v.getUTCFullYear()===j,n=v.getUTCDate(),o=new Date,q=o.getUTCMonth()===k&&o.getUTCFullYear()===j,r=o.getUTCDate();for(i.setUTCDate(1),c=i.getUTCDay(),d=f(j,k),e=f(j,k-1),g=42-d-c,h=c;h;h--)l.push(C({number:e-h+1,prev:!0}));for(h=0;d>h;h++)l.push(C({number:h+1,picked:m&&n==h+1,today:q&&r==h+1}));for(h=0;g>h;h++)l.push(C({number:h+1,next:!0}));b(l.join("")).appendTo(p)}function j(c,e){var f=e?d(c,e):c,i=m.timepicker.defaults.yearRange,j={text:m.timepicker.text,month:f.getUTCMonth(),date:f.getUTCDate(),year:f.getUTCFullYear(),rang:i};o=b(y(j)).appendTo(g(h)).on("selectstart",function(a){a.preventDefault()}),t=new Date(0,0,0),u=new Date(+f),v=new Date(+f),o.data("time.hcx",u),o.data("picked.time.hcx",v),p=o.find(".timepicker-pick"),r=o.find(".timepicker-month-field"),s=o.find(".timepicker-year-field"),k(f),a.scan(o[0]),o[0].offsetWidth}function k(a){t.getUTCFullYear()!==a.getUTCFullYear()?(l(a),n(a)):t.getUTCMonth()!==a.getUTCMonth()&&n(a),t=new Date(+a)}function l(a){s.text(a.getUTCFullYear())}function n(a){p.empty().append(i(a)),r.text(m.timepicker.text.months[a.getUTCMonth()])}var o,p,q,r,s,t,u,v,w,x,y=a.template(this.passing),z={yyyy:function(a,b){return a.setUTCFullYear(b)},m:function(a,b){for(b-=1;0>b;)a+=12;for(b%=12,a.setUTCMonth(b);a.getUTCMonth()!=b;){if(isNaN(a.getUTCMonth()))return a;a.setUTCDate(a.getUTCDate()-1)}return a},d:function(a,b){return a.setUTCDate(+b)}},A={yyyy:function(a){return a.getUTCFullYear()},m:function(a){return a.getUTCMonth()+1},mm:function(a){var b=A.m(a);return(10>b?"0":"")+b},d:function(a){return a.getUTCDate()},dd:function(a){var b=A.d(a);return(10>b?"0":"")+b}},B=/dd?|DD?|mm?|MM?|yyyy/g,C=a.template('<a href="javascript:;" class="timepicker-days{{if prev}} timepicker-days-prev{{elseif next}} timepicker-days-next{{/if}}{{if picked}} timepicker-days-picked{{/if}}{{if today}} timepicker-days-today{{/if}}">{{number}}</a>'),D={},E=this;z.mm=z.m,z.dd=z.d,this.plugin("time",{show:function(a,b){var c;return o?(c=d(a,b),+c!==+t&&(v.setTime(+c),this.pick(),t=c)):j(a,b),o.addClass("in").show(),this},move:function(a){return o.css({top:a.top,left:a.left}),this},change:function(){w.value=e(v,x.format)},fade:function(){o.removeClass("in"),E.css3.transitionEnd(o[0],function(){o.hide()}),g(h).removeData("time.hcx")},toggle:function(a){q=!q,q?this.show(a):this.fade()},update:function(){k(u)},pick:function(){u.setTime(+v),k(v)},related:function(a,b){return x=b,w=a,this}})}).required(["#css3.transition","#time.template"]).one(!0),a("#time").core(function(){var a,c=g(h).data("time.hcx"),d=b.extend(!0,{},m.timepicker.defaults,g(this.element).data("time"),g(this.target).data("time")),e=g(this.target);c&&e.is(c)?(g(h).removeData("time.hcx"),this.time.fade()):(a=e.offset(),a.top+=e.outerHeight(),g(h).data("time.hcx",this.target),this.time.related(this.target,d).show(this.target.value,d.format).move(a))}).required("#time.plugin").pack(),a("#ajax-button").core(function(){return this.follow("@api"),g(this.target).data("remote")}),a("#ajax-button.modal").core(function(){this.alert(this.passing.message)}).required(["#alert"]),a("!ajax-button").queue(["#ajax-button","#ajax-button.modal"]),a("!confirm-button").queue(["$confirm","!ajax-button"]),a("#delete.fade").core(function(){var a=g(this.element).data("delete"),b=g(this.target).closest(a.target);this.css3.transitionEnd(b[0],function(){g(this).remove()}),b.addClass("fade")}).required(["@css3"]).pack(),a("!delete").queue(["#ajax-button","#delete.fade"]),a("!delete.confirm").queue(["$confirm","!delete"]),a("#filters").core(function(){g(this.element).submit()}).pack(),a("#ignore").core(function(){g(this.target).parent().addClass("ignored")}),a("!ignore").queue(["#ajax-button","#ignore"]),a("#push.init").core(function(){return this.follow("$ajax"),g(this.target).data("remote")}),a("#push.template").core(function(){var c,d=g(this.element).data("push")||{},e=a.template(document.getElementById("push-content").innerHTML)({list:this.passing,max:d.max});this.plugin("push",function(){c=b(e),c.data({push:g(this.target).data("push"),button:this.target}),this.modal.content(c).pop()})}).required(["#modal"]),a("#push").core(function(){a("!push.select").reset(),this.push()}),a("#push.register").core(function(){var a=g(this.element);this.register("push",{dom:{list:a.find(".modal-push-list").children(),pushed:a.find(".modal-push-pushed"),count:a.find(".modal-push-count")},data:[],count:0})}).one(),a("#push.select").core(function(){var a,c=b(this.element).data("max"),d=g(this.target),e=this.push,f=[];if(d.hasClass("pushed"))a=d.data("push-from"),d.removeClass("pushed"),a.append(this.target),_.pull(e.data,d.data("value")),e.count--,e.dom.count.text(e.count),a.find("dd").length&&a.removeClass("push-empty");else{if(!d.hasClass("push-item"))return _.each(e.data,function(a){f.push({name:"pushed[]",value:a})}),_.each(g(this.element).data("push"),function(a,b){f.push({name:b,value:a})}),this.follow("@push.done"),_.assume(this,"backup",{}).api="#push.fail",{url:g(this.element).data("remote"),data:f,method:"POST"};if(e.count==c)return;a=d.parent(),d.addClass("pushed"),d.data("push-from",a),e.dom.pushed.append(this.target),a.find("dd").length||a.addClass("push-empty"),e.data.push(d.data("value")),e.count++,e.dom.count.text(e.count)}}).required("#push.register").pack(),a("#push.done").core(function(){this.modal.fade(),g(g(this.element).data("button")).parent().addClass("pushed").removeClass("ignored")}).required(["#modal"]),a("#push.fail").core(function(){this.modal.fade()}).required(["#modal"]),a("!push").queue(["#push.init","#push.template","#push"]),a("@push.done").queue(["@api","#push.done"]),a("#remark").core(function(){return b(this.target).parent().addClass("remarked"),this.modal.fade(),{url:g(this.target).data("remark"),data:this.passing}}),a("!remark").queue(["!form.modal","$event.form","#remark","@api"]),a("#order").core(function(){var a=this.target,b=a.name,c=g(a).closest("[data-order]").data("order"),d=g(this.element).data("order");return c[b]=a.value,{url:d,method:"GET",data:c}}).pack(),a("!order").queue(["#order","@api"]).single(),a("#switch").core(function(){var a,c,d,e,f,h,i=g(this.element).data("switch")||{},j=i.delegate;return d=g(this.target),f=d.data("injection"),j&&(d=d.closest(j)),c=d.data("switch")||{},e=b.extend(!0,m.switches.turn,m.switches[c.type||i.type]),a=+!g(this.target).addClass("switching").hasClass("switch-on"),h=c.url.replace(e.replaced,e.replacer[a]),this.switches={state:+!a,text:e.text,delegate:j,classes:e.classes},f&&(this.follow("!"+f),this.switchUrl=h,_.assume(this,"backup",{})["event.form"]="#switch.always"),h}),a("#switch.always").core(function(){g(this.target).removeClass("switching")}),a("#switch.change").core(function(){var a,b=this.switches,c=b.text,d=b.state,e=b.delegate,f=g(this.target);e?(f=f.closest(e),a=b.classes,f.removeClass(a[d]).addClass(a[1-d])):f.toggleClass("switch-off").toggleClass("switch-on").text(c[d])}),a("#switch.parse").core(function(){return this.modal.fade(),{url:this.switchUrl,data:this.passing}}),a("!switch").queue(["#switch","@api","#switch.always","#switch.change"]).single(),a("!switch.form").queue(["#switch.form","$event.form"]).required("#form.modal"),a("!switch.modal").queue(["!form.modal","$event.form","#switch.parse"]),a("#toggle").core(function(){var a=g(this.element).data("toggle");g(this.target).closest(a.target).toggleClass("open")}).pack(),a("#back-confirm").core(function(){g(this.element).one("change",function(){g(window).on("beforeunload",function b(){return a.Namespace("back-confirm.hcx")("disable")?void g(window).off("beforeunload",b):"您有未保存的修改\n确定要退出本页面吗？"})})}).pack(),a("#checkbox").core(function(){var a="ui-checked",b=g(this.target).toggleClass(a);b.find(".ui-field").prop("checked",b.hasClass(a)).trigger("change")}).pack();var r=function(a){return document.getElementById(a)};a("#clone.tpl").core(function(){var b=a.Namespace("tpls.hcx")();this.plugin("clone",function(c){return b[c]||(b[c]=a.template(r(c).innerHTML)),b[c]})}).one("true"),a("#clone.init").core(function(){var c=g(this.element).data("clone"),d=this.clone(c.template);a.scan(b("#"+c.container).html(_.reduce(c.data,function(a,b,c){return b.index=c,a+d(b)},"")))}).required("#clone.tpl").pack(),a("#clone").core(function(){var c=g(this.element).data("clone"),d=this.clone(c.template),e=c.clone;c.max>c.data.length&&(a.scan(b("#"+c.container).append(d(e))),c.data.push(_.clone(e)))}).required("#clone.tpl").pack();var s=function(a,c){return c.then(function(){return b.ajax({url:a,dataType:"script",cache:!0})})},t=m.baseUrl+m.editor.root;a("#editor").core(function(){var a=e("link"),c=b.Deferred().resolve(),d=this;a.rel="stylesheet",a.href=t+m.editor.style,g(h).append(a),_.reduce(m.editor.js,function(a,b){return s(t+b,a)},c).then(function(){var a,c=d.element.id;b.extend(window.UEDITOR_CONFIG,b(d.element).data("editor")),c||(c=d.element.id=("editor"+Math.random()).replace(".","")),a=UE.getEditor(c),a.addListener("contentChange",_.debounce(function(){g(a.container).trigger("change")},150))})}).pack(),a("#radio").core(function(){var a,b="ui-checked",c=g(this.element).data("radio")||{},d=g(this.target),e=d.find(".ui-field");return a=c.set?d.closest(c.set).find(".ui-radio").not(this.target):d.siblings(".ui-radio"),d.hasClass(b)?void(c&&c.cancelable&&(g(this.target).removeClass(b),e.prop("checked",!1).trigger("change"))):(d.addClass(b),e.prop("checked",!0).trigger("change"),void a.removeClass(b).find(".ui-field").prop("checked",!1).trigger("change"))}).pack(),a("#select.relative").core(function(){var a=g(this.target),b=_.clone(a.data("relative")),c=a.data("value"),d=g(a.data("selected.hcx")).data("relative")["default"];return b.target=document.getElementById(b.target),this["select-relative-data"]=b,this.select.slice(b.target,1),d&&this.select["default"](b.target,d),b.url.replace(b.placeholder,c)}),a("#select.relative.render").core(function(){var a=this["select-relative-data"],b=[],c=this.passing[a.field];_.map(c,function(c){b.push({value:c[a["option-value"]],title:c[a["option-title"]]})}),this.select.append(a.target,b)}),a("!select.relative").queue(["#select.relative","@api","#select.relative.render"]).required("#select.register"),a("#effect").core(function(){var c,d=g(this.element),e=d.val(),f=d.data("effect"),h=f[e],i=a.Namespace("cache.effect.hcx"),j=a.Namespace("effect.hcx")();j.effected&&j.effected.removeClass("shown"),h&&(c=i(h),c||(c=i(h,b(h))),c.addClass("shown"),j.effected=c)}).pack(),a("#effect.init").core(function(){var c,d=g(this.element),e=d.val(),f=d.data("effect"),h=f[e];h&&(c=b(h).addClass("shown"),a.Namespace("cache.effect.hcx")(h,c),a.Namespace("effect.hcx")({effected:c}))}).pack(),a("#form").core(function(){var a=b(this.form||this.element);return{url:a.attr("action"),data:a.serialize(),method:a.attr("method")||"POST",cache:!1}}),a("#form.after").core(function(){a.Namespace("back-confirm.hcx")("disable",!0),window.location.href=this.passing.referer}),a("$event.form").core(function(c){function d(){f=h.backup&&h.backup["event.form"],f?h.jump(f):h.cut(),c()}var e,f,g=this.passing,h=this;e=b(this.form).one("click.submit.form",".modal-form-submit",function(){a("#modal").off("fade",d),
c(e.serializeArray())}),a("#modal").once("fade",d),g&&e.find(".modal-form-error").text(g.message)}).pack(),a("@form").queue(["$event.form","#form","@api"]),a("!form").queue(["#form","@api","#form.after"]).single();var u={details:{events:"click",elements:".component-name"},select:{events:"click"},"select-auto":{component:"select",events:"click",initial:"select.init"},"select-init":{initial:"select.init"},scroll:{events:"mousedown mousewheel",initial:"scroll.init"},"login-cover":{initial:"login.cover"},"switch":{elements:".switch",events:"click"},"delete":{elements:".delete",events:"click"},"delete-confirm":{component:"delete.confirm",elements:".delete",events:"click"},filters:{events:"change"},"upload-image":{initial:"upload-image"},"upload-images":{initial:"upload-images",events:"click",elements:".delete",component:"upload.delete"},preview:{events:"click",elements:".preview"},editor:{initial:"editor"},"preview-img":{events:"click",elements:".preview-img",component:"preview.img"},form:{events:"click",elements:".submit"},"back-confirm":{component:"",initial:"back-confirm"},checkbox:{events:"click",elements:".ui-checkbox,.ui-switch"},radio:{events:"click",elements:".ui-radio"},order:{events:"change",elements:".order"},"relative-select":{events:"change",elements:".relative-select",component:"select.relative"},"ajax-button":{events:"click",elements:".ajax-button"},"confirm-button":{events:"click",elements:".confirm-button"},"modal-form":{events:"click",elements:".modal-form-button",component:"form.modal"},ignore:{events:"click",elements:".ignore"},remark:{events:"click",elements:".remark-button"},push:{events:"click",elements:".push-button"},"toggle-open":{events:"click",elements:".title",component:"toggle"},"push-open":{events:"click",elements:".push-category-title",component:"toggle"},"push-select":{events:"click",elements:".push-item,.modal-push-submit",component:"push.select"},time:{events:"click",elements:".ui-time"},"time-panel":{events:"click"},effect:{events:"change",initial:"effect.init"},clone:{initial:"clone.init",events:"click",component:"clone"},"just-delete":{elements:".delete",events:"click",component:"delete.fade"}};_.extend(_.templateSettings,{escape:/{{-([\s\S]+?)}}/g,evaluate:/{{([\s\S]+?)}}/g,interpolate:/{{=([\s\S]+?)}}/g}),f.length=1,b.fn.H=function(b,c,d){var e;return arguments.length>2&&c?(e=[d],e.push(c)):d&&(e=[d]),this.each(function(){var d=g(this),f=this,h=d.data("Horcrux.list");if(h){if(-1!==_.indexOf(d.data("Horcrux.list"),b))return}else h=[],d.data("Horcrux.list",h);e?(e.push(function(d){_.each(b.split(q),function(b){a("!"+b).run(function(){this.runtime({event:d,target:c?g(d.target).closest(c)[0]:f,element:f})})})}),d.on.apply(d,e)):_.each(b.split(q),function(b){a("!"+b).run(function(){this.runtime({element:f})})})}),this},a.extend({scan:function(a){var c;a?(c=b(a).find("[h-com]"),c=c.end().is("[h-com]")?c.andSelf():c):c=g(document).find("[h-com]"),c.each(function(){var a=this,b=this.getAttribute("h-com");_.each(b.split(" "),function(b){d(b,a)})})},connect:d}),a.scan(),a("#toggle").core(function(){var a=g(this.element).data("toggle");g(this.target).closest(a.target).toggleClass("open")}).pack()}(Horcrux,jQuery);