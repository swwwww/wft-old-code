function JPEGEncoder(a) {
    function b(a) {
        var b, c, d, e, f, g, h, i, j, k = [16, 11, 10, 16, 24, 40, 51, 61, 12, 12, 14, 19, 26, 58, 60, 55, 14, 13, 16, 24, 40, 57, 69, 56, 14, 17, 22, 29, 51, 87, 80, 62, 18, 22, 37, 56, 68, 109, 103, 77, 24, 35, 55, 64, 81, 104, 113, 92, 49, 64, 78, 87, 103, 121, 120, 101, 72, 92, 95, 98, 112, 100, 103, 99];
        for (b = 0; 64 > b; b++)c = t((k[b] * a + 50) / 100), 1 > c ? c = 1 : c > 255 && (c = 255), u[P[b]] = c;
        for (d = [17, 18, 24, 47, 99, 99, 99, 99, 18, 21, 26, 66, 99, 99, 99, 99, 24, 26, 56, 99, 99, 99, 99, 99, 47, 66, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99], e = 0; 64 > e; e++)f = t((d[e] * a + 50) / 100), 1 > f ? f = 1 : f > 255 && (f = 255), v[P[e]] = f;
        for (g = [1, 1.387039845, 1.306562965, 1.175875602, 1, .785694958, .5411961, .275899379], h = 0, i = 0; 8 > i; i++)for (j = 0; 8 > j; j++)w[h] = 1 / (8 * u[P[h]] * g[i] * g[j]), x[h] = 1 / (8 * v[P[h]] * g[i] * g[j]), h++
    }

    function c(a, b) {
        var c, d, e = 0, f = 0, g = new Array;
        for (c = 1; 16 >= c; c++) {
            for (d = 1; d <= a[c]; d++)g[b[f]] = [], g[b[f]][0] = e, g[b[f]][1] = c, f++, e++;
            e *= 2
        }
        return g
    }

    function d() {
        y = c(Q, R), z = c(U, V), A = c(S, T), B = c(W, X)
    }

    function e() {
        var a, b, c, d = 1, e = 2;
        for (a = 1; 15 >= a; a++) {
            for (b = d; e > b; b++)D[32767 + b] = a, C[32767 + b] = [], C[32767 + b][1] = a, C[32767 + b][0] = b;
            for (c = -(e - 1); -d >= c; c++)D[32767 + c] = a, C[32767 + c] = [], C[32767 + c][1] = a, C[32767 + c][0] = e - 1 + c;
            d <<= 1, e <<= 1
        }
    }

    function f() {
        for (var a = 0; 256 > a; a++)N[a] = 19595 * a, N[a + 256 >> 0] = 38470 * a, N[a + 512 >> 0] = 7471 * a + 32768, N[a + 768 >> 0] = -11059 * a, N[a + 1024 >> 0] = -21709 * a, N[a + 1280 >> 0] = 32768 * a + 8421375, N[a + 1536 >> 0] = -27439 * a, N[a + 1792 >> 0] = -5329 * a
    }

    function g(a) {
        for (var b = a[0], c = a[1] - 1; c >= 0;)b & 1 << c && (H |= 1 << I), c--, I--, 0 > I && (255 == H ? (h(255), h(0)) : h(H), I = 7, H = 0)
    }

    function h(a) {
        G.push(M[a])
    }

    function i(a) {
        h(255 & a >> 8), h(255 & a)
    }

    function j(a, b) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z = 0;
        const $ = 8, _ = 64;
        for (k = 0; $ > k; ++k)c = a[Z], d = a[Z + 1], e = a[Z + 2], f = a[Z + 3], g = a[Z + 4], h = a[Z + 5], i = a[Z + 6], j = a[Z + 7], l = c + j, m = c - j, n = d + i, o = d - i, p = e + h, q = e - h, r = f + g, s = f - g, t = l + r, u = l - r, v = n + p, w = n - p, a[Z] = t + v, a[Z + 4] = t - v, x = .707106781 * (w + u), a[Z + 2] = u + x, a[Z + 6] = u - x, t = s + q, v = q + o, w = o + m, y = .382683433 * (t - w), z = .5411961 * t + y, A = 1.306562965 * w + y, B = .707106781 * v, C = m + B, D = m - B, a[Z + 5] = D + z, a[Z + 3] = D - z, a[Z + 1] = C + A, a[Z + 7] = C - A, Z += 8;
        for (Z = 0, k = 0; $ > k; ++k)c = a[Z], d = a[Z + 8], e = a[Z + 16], f = a[Z + 24], g = a[Z + 32], h = a[Z + 40], i = a[Z + 48], j = a[Z + 56], F = c + j, G = c - j, H = d + i, I = d - i, J = e + h, K = e - h, L = f + g, M = f - g, N = F + L, O = F - L, P = H + J, Q = H - J, a[Z] = N + P, a[Z + 32] = N - P, R = .707106781 * (Q + O), a[Z + 16] = O + R, a[Z + 48] = O - R, N = M + K, P = K + I, Q = I + G, S = .382683433 * (N - Q), T = .5411961 * N + S, U = 1.306562965 * Q + S, V = .707106781 * P, W = G + V, X = G - V, a[Z + 40] = X + T, a[Z + 24] = X - T, a[Z + 8] = W + U, a[Z + 56] = W - U, Z++;
        for (k = 0; _ > k; ++k)Y = a[k] * b[k], E[k] = Y > 0 ? 0 | Y + .5 : 0 | Y - .5;
        return E
    }

    function k() {
        i(65504), i(16), h(74), h(70), h(73), h(70), h(0), h(1), h(1), h(0), i(1), i(1), h(0), h(0)
    }

    function l(a, b) {
        i(65472), i(17), h(8), i(b), i(a), h(3), h(1), h(17), h(0), h(2), h(17), h(1), h(3), h(17), h(1)
    }

    function m() {
        var a, b;
        for (i(65499), i(132), h(0), a = 0; 64 > a; a++)h(u[a]);
        for (h(1), b = 0; 64 > b; b++)h(v[b])
    }

    function n() {
        var a, b, c, d, e, f, g, j;
        for (i(65476), i(418), h(0), a = 0; 16 > a; a++)h(Q[a + 1]);
        for (b = 0; 11 >= b; b++)h(R[b]);
        for (h(16), c = 0; 16 > c; c++)h(S[c + 1]);
        for (d = 0; 161 >= d; d++)h(T[d]);
        for (h(1), e = 0; 16 > e; e++)h(U[e + 1]);
        for (f = 0; 11 >= f; f++)h(V[f]);
        for (h(17), g = 0; 16 > g; g++)h(W[g + 1]);
        for (j = 0; 161 >= j; j++)h(X[j])
    }

    function o() {
        i(65498), i(12), h(3), h(1), h(0), h(2), h(17), h(3), h(17), h(0), h(63), h(0)
    }

    function p(a, b, c, d, e) {
        var f, h, i, k, l, m, n, o, p, q, r = e[0], s = e[240];
        const t = 16, u = 63, v = 64;
        for (h = j(a, b), i = 0; v > i; ++i)F[P[i]] = h[i];
        for (k = F[0] - c, c = F[0], 0 == k ? g(d[0]) : (f = 32767 + k, g(d[D[f]]), g(C[f])), l = 63; l > 0 && 0 == F[l]; l--);
        if (0 == l)return g(r), c;
        for (m = 1; l >= m;) {
            for (o = m; 0 == F[m] && l >= m; ++m);
            if (p = m - o, p >= t) {
                for (n = p >> 4, q = 1; n >= q; ++q)g(s);
                p = 15 & p
            }
            f = 32767 + F[m], g(e[(p << 4) + D[f]]), g(C[f]), m++
        }
        return l != u && g(r), c
    }

    function q() {
        var a, b = String.fromCharCode;
        for (a = 0; 256 > a; a++)M[a] = b(a)
    }

    function r(a) {
        if (0 >= a && (a = 1), a > 100 && (a = 100), O != a) {
            var c = 0;
            c = 50 > a ? Math.floor(5e3 / a) : Math.floor(200 - 2 * a), b(c), O = a, console.log("Quality set to: " + a + "%")
        }
    }

    function s() {
        var b, c = (new Date).getTime();
        a || (a = 50), q(), d(), e(), f(), r(a), b = (new Date).getTime() - c, console.log("Initialization " + b + "ms")
    }

    var t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X;
    Math.round, t = Math.floor, u = new Array(64), v = new Array(64), w = new Array(64), x = new Array(64), C = new Array(65535), D = new Array(65535), E = new Array(64), F = new Array(64), G = [], H = 0, I = 7, J = new Array(64), K = new Array(64), L = new Array(64), M = new Array(256), N = new Array(2048), P = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53, 10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63], Q = [0, 0, 1, 5, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0], R = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], S = [0, 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 125], T = [1, 2, 3, 0, 4, 17, 5, 18, 33, 49, 65, 6, 19, 81, 97, 7, 34, 113, 20, 50, 129, 145, 161, 8, 35, 66, 177, 193, 21, 82, 209, 240, 36, 51, 98, 114, 130, 9, 10, 22, 23, 24, 25, 26, 37, 38, 39, 40, 41, 42, 52, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250], U = [0, 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], V = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], W = [0, 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 119], X = [0, 1, 2, 3, 17, 4, 5, 33, 49, 6, 18, 65, 81, 7, 97, 113, 19, 34, 50, 129, 8, 20, 66, 145, 161, 177, 193, 9, 35, 51, 82, 240, 21, 98, 114, 209, 10, 22, 36, 52, 225, 37, 241, 23, 24, 25, 26, 38, 39, 40, 41, 42, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 130, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 226, 227, 228, 229, 230, 231, 232, 233, 234, 242, 243, 244, 245, 246, 247, 248, 249, 250], this.encode = function (a, b) {
        var c, d, e, f, h, j, q, s, t, u, v, C, D, E, F, M, O, P, Q, R, S = (new Date).getTime();
        for (b && r(b), G = new Array, H = 0, I = 7, i(65496), k(), m(), l(a.width, a.height), n(), o(), c = 0, d = 0, e = 0, H = 0, I = 7, this.encode.displayName = "_encode_", f = a.data, h = a.width, j = a.height, q = 4 * h, t = 0; j > t;) {
            for (s = 0; q > s;) {
                for (D = q * t + s, E = D, F = -1, M = 0, O = 0; 64 > O; O++)M = O >> 3, F = 4 * (7 & O), E = D + M * q + F, t + M >= j && (E -= q * (t + 1 + M - j)), s + F >= q && (E -= s + F - q + 4), u = f[E++], v = f[E++], C = f[E++], J[O] = (N[u] + N[v + 256 >> 0] + N[C + 512 >> 0] >> 16) - 128, K[O] = (N[u + 768 >> 0] + N[v + 1024 >> 0] + N[C + 1280 >> 0] >> 16) - 128, L[O] = (N[u + 1280 >> 0] + N[v + 1536 >> 0] + N[C + 1792 >> 0] >> 16) - 128;
                c = p(J, w, c, y, A), d = p(K, x, d, z, B), e = p(L, x, e, z, B), s += 32
            }
            t += 8
        }
        return I >= 0 && (P = [], P[1] = I + 1, P[0] = (1 << I + 1) - 1, g(P)), i(65497), Q = "data:image/jpeg;base64," + btoa(G.join("")), G = [], R = (new Date).getTime() - S, console.log("Encoding time: " + R + "ms"), Q
    }, s()
}
function getImageDataFromImage(a) {
    var b, c = "string" == typeof a ? document.getElementById(a) : a, d = document.createElement("canvas");
    return d.width = c.width, d.height = c.height, b = d.getContext("2d"), b.drawImage(c, 0, 0), b.getImageData(0, 0, d.width, d.height)
}
var BinaryFile = function (a, b, c) {
    var d = a, e = b || 0, f = 0;
    this.getRawData = function () {
        return d
    }, "string" == typeof a ? (f = c || d.length, this.getByteAt = function (a) {
        return 255 & d.charCodeAt(a + e)
    }, this.getBytesAt = function (a, b) {
        for (var c = [], f = 0; b > f; f++)c[f] = 255 & d.charCodeAt(a + f + e);
        return c
    }) : "unknown" == typeof a && (f = c || IEBinary_getLength(d), this.getByteAt = function (a) {
        return IEBinary_getByteAt(d, a + e)
    }, this.getBytesAt = function (a, b) {
        return new VBArray(IEBinary_getBytesAt(d, a + e, b)).toArray()
    }), this.getLength = function () {
        return f
    }, this.getSByteAt = function (a) {
        var b = this.getByteAt(a);
        return b > 127 ? b - 256 : b
    }, this.getShortAt = function (a, b) {
        var c = b ? (this.getByteAt(a) << 8) + this.getByteAt(a + 1) : (this.getByteAt(a + 1) << 8) + this.getByteAt(a);
        return 0 > c && (c += 65536), c
    }, this.getSShortAt = function (a, b) {
        var c = this.getShortAt(a, b);
        return c > 32767 ? c - 65536 : c
    }, this.getLongAt = function (a, b) {
        var c = this.getByteAt(a), d = this.getByteAt(a + 1), e = this.getByteAt(a + 2), f = this.getByteAt(a + 3), g = b ? (((c << 8) + d << 8) + e << 8) + f : (((f << 8) + e << 8) + d << 8) + c;
        return 0 > g && (g += 4294967296), g
    }, this.getSLongAt = function (a, b) {
        var c = this.getLongAt(a, b);
        return c > 2147483647 ? c - 4294967296 : c
    }, this.getStringAt = function (a, b) {
        for (var c = [], d = this.getBytesAt(a, b), e = 0; b > e; e++)c[e] = String.fromCharCode(d[e]);
        return c.join("")
    }, this.getCharAt = function (a) {
        return String.fromCharCode(this.getByteAt(a))
    }, this.toBase64 = function () {
        return window.btoa(d)
    }, this.fromBase64 = function (a) {
        d = window.atob(a)
    }
}, BinaryAjax = function () {
    function a() {
        var a = null;
        return window.ActiveXObject ? a = new ActiveXObject("Microsoft.XMLHTTP") : window.XMLHttpRequest && (a = new XMLHttpRequest), a
    }

    function b(b, c, d) {
        var e = a();
        e ? (c && ("undefined" != typeof e.onload ? e.onload = function () {
            "200" == e.status ? c(this) : d && d(), e = null
        } : e.onreadystatechange = function () {
            4 == e.readyState && ("200" == e.status ? c(this) : d && d(), e = null)
        }), e.open("HEAD", b, !0), e.send(null)) : d && d()
    }

    function c(b, c, d, e, f, g) {
        var h = a();
        if (h) {
            var i = 0;
            e && !f && (i = e[0]);
            var j = 0;
            e && (j = e[1] - e[0] + 1), c && ("undefined" != typeof h.onload ? h.onload = function () {
                "200" == h.status || "206" == h.status || "0" == h.status ? (h.binaryResponse = new BinaryFile(h.responseText, i, j), h.fileSize = g || h.getResponseHeader("Content-Length"), c(h)) : d && d(), h = null
            } : h.onreadystatechange = function () {
                if (4 == h.readyState) {
                    if ("200" == h.status || "206" == h.status || "0" == h.status) {
                        var a = {
                            status: h.status,
                            binaryResponse: new BinaryFile("unknown" == typeof h.responseBody ? h.responseBody : h.responseText, i, j),
                            fileSize: g || h.getResponseHeader("Content-Length")
                        };
                        c(a)
                    } else d && d();
                    h = null
                }
            }), h.open("GET", b, !0), h.overrideMimeType && h.overrideMimeType("text/plain; charset=x-user-defined"), e && f && h.setRequestHeader("Range", "bytes=" + e[0] + "-" + e[1]), h.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 1970 00:00:00 GMT"), h.send(null)
        } else d && d()
    }

    return function (a, d, e, f) {
        f ? b(a, function (b) {
            var g, h, i = parseInt(b.getResponseHeader("Content-Length"), 10), j = b.getResponseHeader("Accept-Ranges");
            g = f[0], f[0] < 0 && (g += i), h = g + f[1] - 1, c(a, d, e, [g, h], "bytes" == j, i)
        }) : c(a, d, e)
    }
}();
document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n	IEBinary_getByteAt = AscB(MidB(strBinary, iOffset + 1, 1))\r\nEnd Function\r\nFunction IEBinary_getBytesAt(strBinary, iOffset, iLength)\r\n  Dim aBytes()\r\n  ReDim aBytes(iLength - 1)\r\n  For i = 0 To iLength - 1\r\n   aBytes(i) = IEBinary_getByteAt(strBinary, iOffset + i)\r\n  Next\r\n  IEBinary_getBytesAt = aBytes\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n	IEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n</script>\r\n");
var EXIF = {};
!function () {
    function a(a) {
        if (255 != a.getByteAt(0) || 216 != a.getByteAt(1))return !1;
        for (var b = 2, c = a.getLength(); c > b;) {
            if (255 != a.getByteAt(b))return e && console.log("Not a valid marker at offset " + b + ", found: " + a.getByteAt(b)), !1;
            var f = a.getByteAt(b + 1);
            if (22400 == f)return e && console.log("Found 0xFFE1 marker"), d(a, b + 4, a.getShortAt(b + 2, !0) - 2);
            if (225 == f)return e && console.log("Found 0xFFE1 marker"), d(a, b + 4, a.getShortAt(b + 2, !0) - 2);
            b += 2 + a.getShortAt(b + 2, !0)
        }
    }

    function b(a, b, d, f, g) {
        for (var h = a.getShortAt(d, g), i = {}, j = 0; h > j; j++) {
            var k = d + 12 * j + 2, l = f[a.getShortAt(k, g)];
            !l && e && console.log("Unknown tag: " + a.getShortAt(k, g)), i[l] = c(a, k, b, d, g)
        }
        return i
    }

    function c(a, b, c, d, e) {
        var f = a.getShortAt(b + 2, e), g = a.getLongAt(b + 4, e), h = a.getLongAt(b + 8, e) + c;
        switch (f) {
            case 1:
            case 7:
                if (1 == g)return a.getByteAt(b + 8, e);
                for (var i = g > 4 ? h : b + 8, j = [], k = 0; g > k; k++)j[k] = a.getByteAt(i + k);
                return j;
            case 2:
                var l = g > 4 ? h : b + 8;
                return a.getStringAt(l, g - 1);
            case 3:
                if (1 == g)return a.getShortAt(b + 8, e);
                for (var i = g > 2 ? h : b + 8, j = [], k = 0; g > k; k++)j[k] = a.getShortAt(i + 2 * k, e);
                return j;
            case 4:
                if (1 == g)return a.getLongAt(b + 8, e);
                for (var j = [], k = 0; g > k; k++)j[k] = a.getLongAt(h + 4 * k, e);
                return j;
            case 5:
                if (1 == g)return a.getLongAt(h, e) / a.getLongAt(h + 4, e);
                for (var j = [], k = 0; g > k; k++)j[k] = a.getLongAt(h + 8 * k, e) / a.getLongAt(h + 4 + 8 * k, e);
                return j;
            case 9:
                if (1 == g)return a.getSLongAt(b + 8, e);
                for (var j = [], k = 0; g > k; k++)j[k] = a.getSLongAt(h + 4 * k, e);
                return j;
            case 10:
                if (1 == g)return a.getSLongAt(h, e) / a.getSLongAt(h + 4, e);
                for (var j = [], k = 0; g > k; k++)j[k] = a.getSLongAt(h + 8 * k, e) / a.getSLongAt(h + 4 + 8 * k, e);
                return j
        }
    }

    function d(a, c, d) {
        if ("Exif" != a.getStringAt(c, 4))return e && console.log("Not valid EXIF data! " + a.getStringAt(c, 4)), !1;
        var f, g = c + 6;
        if (18761 == a.getShortAt(g))f = !1; else {
            if (19789 != a.getShortAt(g))return e && console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"), !1;
            f = !0
        }
        if (42 != a.getShortAt(g + 2, f))return e && console.log("Not valid TIFF data! (no 0x002A)"), !1;
        if (8 != a.getLongAt(g + 4, f))return e && console.log("Not valid TIFF data! (First offset not 8)", a.getShortAt(g + 4, f)), !1;
        var h = b(a, g, g + 8, EXIF.TiffTags, f);
        if (h.ExifIFDPointer) {
            var i = b(a, g, g + h.ExifIFDPointer, EXIF.Tags, f);
            for (var j in i) {
                switch (j) {
                    case"LightSource":
                    case"Flash":
                    case"MeteringMode":
                    case"ExposureProgram":
                    case"SensingMethod":
                    case"SceneCaptureType":
                    case"SceneType":
                    case"CustomRendered":
                    case"WhiteBalance":
                    case"GainControl":
                    case"Contrast":
                    case"Saturation":
                    case"Sharpness":
                    case"SubjectDistanceRange":
                    case"FileSource":
                        i[j] = EXIF.StringValues[j][i[j]];
                        break;
                    case"ExifVersion":
                    case"FlashpixVersion":
                        i[j] = String.fromCharCode(i[j][0], i[j][1], i[j][2], i[j][3]);
                        break;
                    case"ComponentsConfiguration":
                        i[j] = EXIF.StringValues.Components[i[j][0]] + EXIF.StringValues.Components[i[j][1]] + EXIF.StringValues.Components[i[j][2]] + EXIF.StringValues.Components[i[j][3]]
                }
                h[j] = i[j]
            }
        }
        if (h.GPSInfoIFDPointer) {
            var k = b(a, g, g + h.GPSInfoIFDPointer, EXIF.GPSTags, f);
            for (var j in k) {
                switch (j) {
                    case"GPSVersionID":
                        k[j] = k[j][0] + "." + k[j][1] + "." + k[j][2] + "." + k[j][3]
                }
                h[j] = k[j]
            }
        }
        return h
    }

    var e = !1;
    EXIF.Tags = {
        36864: "ExifVersion",
        40960: "FlashpixVersion",
        40961: "ColorSpace",
        40962: "PixelXDimension",
        40963: "PixelYDimension",
        37121: "ComponentsConfiguration",
        37122: "CompressedBitsPerPixel",
        37500: "MakerNote",
        37510: "UserComment",
        40964: "RelatedSoundFile",
        36867: "DateTimeOriginal",
        36868: "DateTimeDigitized",
        37520: "SubsecTime",
        37521: "SubsecTimeOriginal",
        37522: "SubsecTimeDigitized",
        33434: "ExposureTime",
        33437: "FNumber",
        34850: "ExposureProgram",
        34852: "SpectralSensitivity",
        34855: "ISOSpeedRatings",
        34856: "OECF",
        37377: "ShutterSpeedValue",
        37378: "ApertureValue",
        37379: "BrightnessValue",
        37380: "ExposureBias",
        37381: "MaxApertureValue",
        37382: "SubjectDistance",
        37383: "MeteringMode",
        37384: "LightSource",
        37385: "Flash",
        37396: "SubjectArea",
        37386: "FocalLength",
        41483: "FlashEnergy",
        41484: "SpatialFrequencyResponse",
        41486: "FocalPlaneXResolution",
        41487: "FocalPlaneYResolution",
        41488: "FocalPlaneResolutionUnit",
        41492: "SubjectLocation",
        41493: "ExposureIndex",
        41495: "SensingMethod",
        41728: "FileSource",
        41729: "SceneType",
        41730: "CFAPattern",
        41985: "CustomRendered",
        41986: "ExposureMode",
        41987: "WhiteBalance",
        41988: "DigitalZoomRation",
        41989: "FocalLengthIn35mmFilm",
        41990: "SceneCaptureType",
        41991: "GainControl",
        41992: "Contrast",
        41993: "Saturation",
        41994: "Sharpness",
        41995: "DeviceSettingDescription",
        41996: "SubjectDistanceRange",
        40965: "InteroperabilityIFDPointer",
        42016: "ImageUniqueID"
    }, EXIF.TiffTags = {
        256: "ImageWidth",
        257: "ImageHeight",
        34665: "ExifIFDPointer",
        34853: "GPSInfoIFDPointer",
        40965: "InteroperabilityIFDPointer",
        258: "BitsPerSample",
        259: "Compression",
        262: "PhotometricInterpretation",
        274: "Orientation",
        277: "SamplesPerPixel",
        284: "PlanarConfiguration",
        530: "YCbCrSubSampling",
        531: "YCbCrPositioning",
        282: "XResolution",
        283: "YResolution",
        296: "ResolutionUnit",
        273: "StripOffsets",
        278: "RowsPerStrip",
        279: "StripByteCounts",
        513: "JPEGInterchangeFormat",
        514: "JPEGInterchangeFormatLength",
        301: "TransferFunction",
        318: "WhitePoint",
        319: "PrimaryChromaticities",
        529: "YCbCrCoefficients",
        532: "ReferenceBlackWhite",
        306: "DateTime",
        270: "ImageDescription",
        271: "Make",
        272: "Model",
        305: "Software",
        315: "Artist",
        33432: "Copyright"
    }, EXIF.GPSTags = {
        0: "GPSVersionID",
        1: "GPSLatitudeRef",
        2: "GPSLatitude",
        3: "GPSLongitudeRef",
        4: "GPSLongitude",
        5: "GPSAltitudeRef",
        6: "GPSAltitude",
        7: "GPSTimeStamp",
        8: "GPSSatellites",
        9: "GPSStatus",
        10: "GPSMeasureMode",
        11: "GPSDOP",
        12: "GPSSpeedRef",
        13: "GPSSpeed",
        14: "GPSTrackRef",
        15: "GPSTrack",
        16: "GPSImgDirectionRef",
        17: "GPSImgDirection",
        18: "GPSMapDatum",
        19: "GPSDestLatitudeRef",
        20: "GPSDestLatitude",
        21: "GPSDestLongitudeRef",
        22: "GPSDestLongitude",
        23: "GPSDestBearingRef",
        24: "GPSDestBearing",
        25: "GPSDestDistanceRef",
        26: "GPSDestDistance",
        27: "GPSProcessingMethod",
        28: "GPSAreaInformation",
        29: "GPSDateStamp",
        30: "GPSDifferential"
    }, EXIF.StringValues = {
        ExposureProgram: {
            0: "Not defined",
            1: "Manual",
            2: "Normal program",
            3: "Aperture priority",
            4: "Shutter priority",
            5: "Creative program",
            6: "Action program",
            7: "Portrait mode",
            8: "Landscape mode"
        },
        MeteringMode: {
            0: "Unknown",
            1: "Average",
            2: "CenterWeightedAverage",
            3: "Spot",
            4: "MultiSpot",
            5: "Pattern",
            6: "Partial",
            255: "Other"
        },
        LightSource: {
            0: "Unknown",
            1: "Daylight",
            2: "Fluorescent",
            3: "Tungsten (incandescent light)",
            4: "Flash",
            9: "Fine weather",
            10: "Cloudy weather",
            11: "Shade",
            12: "Daylight fluorescent (D 5700 - 7100K)",
            13: "Day white fluorescent (N 4600 - 5400K)",
            14: "Cool white fluorescent (W 3900 - 4500K)",
            15: "White fluorescent (WW 3200 - 3700K)",
            17: "Standard light A",
            18: "Standard light B",
            19: "Standard light C",
            20: "D55",
            21: "D65",
            22: "D75",
            23: "D50",
            24: "ISO studio tungsten",
            255: "Other"
        },
        Flash: {
            0: "Flash did not fire",
            1: "Flash fired",
            5: "Strobe return light not detected",
            7: "Strobe return light detected",
            9: "Flash fired, compulsory flash mode",
            13: "Flash fired, compulsory flash mode, return light not detected",
            15: "Flash fired, compulsory flash mode, return light detected",
            16: "Flash did not fire, compulsory flash mode",
            24: "Flash did not fire, auto mode",
            25: "Flash fired, auto mode",
            29: "Flash fired, auto mode, return light not detected",
            31: "Flash fired, auto mode, return light detected",
            32: "No flash function",
            65: "Flash fired, red-eye reduction mode",
            69: "Flash fired, red-eye reduction mode, return light not detected",
            71: "Flash fired, red-eye reduction mode, return light detected",
            73: "Flash fired, compulsory flash mode, red-eye reduction mode",
            77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
            79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
            89: "Flash fired, auto mode, red-eye reduction mode",
            93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
            95: "Flash fired, auto mode, return light detected, red-eye reduction mode"
        },
        SensingMethod: {
            1: "Not defined",
            2: "One-chip color area sensor",
            3: "Two-chip color area sensor",
            4: "Three-chip color area sensor",
            5: "Color sequential area sensor",
            7: "Trilinear sensor",
            8: "Color sequential linear sensor"
        },
        SceneCaptureType: {0: "Standard", 1: "Landscape", 2: "Portrait", 3: "Night scene"},
        SceneType: {1: "Directly photographed"},
        CustomRendered: {0: "Normal process", 1: "Custom process"},
        WhiteBalance: {0: "Auto white balance", 1: "Manual white balance"},
        GainControl: {0: "None", 1: "Low gain up", 2: "High gain up", 3: "Low gain down", 4: "High gain down"},
        Contrast: {0: "Normal", 1: "Soft", 2: "Hard"},
        Saturation: {0: "Normal", 1: "Low saturation", 2: "High saturation"},
        Sharpness: {0: "Normal", 1: "Soft", 2: "Hard"},
        SubjectDistanceRange: {0: "Unknown", 1: "Macro", 2: "Close view", 3: "Distant view"},
        FileSource: {3: "DSC"},
        Components: {0: "", 1: "Y", 2: "Cb", 3: "Cr", 4: "R", 5: "G", 6: "B"}
    }, EXIF.readFromBinaryFile = function (b) {
        return a(b)
    }
}(), $.fn.localResizeIMG = function (a) {
    function b(b) {
        var d = new Image;
        d.src = b, d.onload = function () {
            var b = this, e = b.width, f = b.height, g = e / f;
            e = a.width || e, f = e / g;
            var h = document.createElement("canvas");
            h.width = e, h.height = f;
            var i = h.getContext("2d");
            switch (c) {
                case 1:
                    i.rotate(0 * Math.PI / 180), i.drawImage(b, 0, 0, e, f);
                    break;
                case 6:
                    h.width = f, h.height = e, i.rotate(90 * Math.PI / 180), i.drawImage(b, 0, -f, e, f);
                    var j = e;
                    e = f, f = j;
                    break;
                case 3:
                    i.rotate(180 * Math.PI / 180), i.drawImage(b, -e, -f, e, f);
                    break;
                case 8:
                    h.width = f, h.height = e, i.rotate(270 * Math.PI / 180), i.drawImage(b, -e, 0, e, f);
                    var j = e;
                    e = f, f = j
            }
            var k = h.toDataURL("image/jpeg", a.quality || .8);
            if (navigator.userAgent.match(/iphone/i)) {
                var l = new MegaPixImage(d);
                l.render(h, {
                    maxWidth: e,
                    maxHeight: f,
                    quality: a.quality || .8,
                    orientation: c
                }), k = h.toDataURL("image/jpeg", a.quality || .8)
            }
            if (navigator.userAgent.match(/Android/i)) {
                var m = new JPEGEncoder;
                k = m.encode(i.getImageData(0, 0, e, f), 100 * a.quality || 80)
            }
            var n = {height: f, base64: k, clearBase64: k.substr(k.indexOf(",") + 1)};
            a.success(n)
        }
    }

    var c;
    this.on("change", function () {
        var d = this.files[0], e = e || webkitURL, f = e.createObjectURL(d), g = new FileReader;
        g.onloadend = function () {
            var a = EXIF.readFromBinaryFile(new BinaryFile(this.result));
            c = a.Orientation ? a.Orientation : 1
        }, g.readAsBinaryString(d), $.isFunction(a.before) && a.before(this, f, d), b(f, d), this.value = ""
    })
}, !function () {
    function a(a) {
        var b, c, d = a.naturalWidth, e = a.naturalHeight;
        return d * e > 1048576 ? (b = document.createElement("canvas"), b.width = b.height = 1, c = b.getContext("2d"), c.drawImage(a, -d + 1, 0), 0 === c.getImageData(0, 0, 1, 1).data[3]) : !1
    }

    function b(a, b, c) {
        var d, e, f, g, h, i, j, k = document.createElement("canvas");
        for (k.width = 1, k.height = c, d = k.getContext("2d"), d.drawImage(a, 0, 0), e = d.getImageData(0, 0, 1, c).data, f = 0, g = c, h = c; h > f;)i = e[4 * (h - 1) + 3], 0 === i ? g = h : f = h, h = g + f >> 1;
        return j = h / c, 0 === j ? 1 : j
    }

    function c(a, b, c) {
        var e = document.createElement("canvas");
        return d(a, e, b, c), e.toDataURL("image/jpeg", b.quality || .8)
    }

    function d(c, d, f, g) {
        var h, i, j, k, l, m, n, o, p, q, r, s = c.naturalWidth, t = c.naturalHeight, u = f.width, v = f.height, w = d.getContext("2d");
        for (w.save(), e(d, w, u, v, f.orientation), h = a(c), h && (s /= 2, t /= 2), i = 1024, j = document.createElement("canvas"), j.width = j.height = i, k = j.getContext("2d"), l = g ? b(c, s, t) : 1, m = Math.ceil(i * u / s), n = Math.ceil(i * v / t / l), o = 0, p = 0; t > o;) {
            for (q = 0, r = 0; s > q;)k.clearRect(0, 0, i, i), k.drawImage(c, -q, -o), w.drawImage(j, 0, 0, i, i, r, p, m, n), q += i, r += m;
            o += i, p += n
        }
        w.restore(), j = k = null
    }

    function e(a, b, c, d, e) {
        switch (e) {
            case 5:
            case 6:
            case 7:
            case 8:
                a.width = d, a.height = c;
                break;
            default:
                a.width = c, a.height = d
        }
        switch (e) {
            case 2:
                b.translate(c, 0), b.scale(-1, 1);
                break;
            case 3:
                b.translate(c, d), b.rotate(Math.PI);
                break;
            case 4:
                b.translate(0, d), b.scale(1, -1);
                break;
            case 5:
                b.rotate(.5 * Math.PI), b.scale(1, -1);
                break;
            case 6:
                b.rotate(.5 * Math.PI), b.translate(0, -d);
                break;
            case 7:
                b.rotate(.5 * Math.PI), b.translate(c, -d), b.scale(-1, 1);
                break;
            case 8:
                b.rotate(-.5 * Math.PI), b.translate(-c, 0)
        }
    }

    function f(a) {
        var b, c, d;
        if (window.Blob && a instanceof Blob) {
            if (b = new Image, c = window.URL && window.URL.createObjectURL ? window.URL : window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL : null, !c)throw Error("No createObjectURL function found to create blob url");
            b.src = c.createObjectURL(a), this.blob = a, a = b
        }
        a.naturalWidth || a.naturalHeight || (d = this, a.onload = function () {
            var a, b, c = d.imageLoadListeners;
            if (c)for (d.imageLoadListeners = null, a = 0, b = c.length; b > a; a++)c[a]()
        }, this.imageLoadListeners = []), this.srcImage = a
    }

    f.prototype.render = function (a, b, e) {
        var f, g, h, i, j, k, l, m, n, o, p;
        if (this.imageLoadListeners)return f = this, void this.imageLoadListeners.push(function () {
            f.render(a, b, e)
        });
        b = b || {}, g = this.srcImage.naturalWidth, h = this.srcImage.naturalHeight, i = b.width, j = b.height, k = b.maxWidth, l = b.maxHeight, m = !this.blob || "image/jpeg" === this.blob.type, i && !j ? j = h * i / g << 0 : j && !i ? i = g * j / h << 0 : (i = g, j = h), k && i > k && (i = k, j = h * i / g << 0), l && j > l && (j = l, i = g * j / h << 0), n = {
            width: i,
            height: j
        };
        for (o in b)n[o] = b[o];
        p = a.tagName.toLowerCase(), "img" === p ? a.src = c(this.srcImage, n, m) : "canvas" === p && d(this.srcImage, a, n, m), "function" == typeof this.onrender && this.onrender(a), e && e()
    }, "function" == typeof define && define.amd ? define([], function () {
        return f
    }) : this.MegaPixImage = f
}(), $(function () {
    function fileupload() {
        var a = '<input type="file" id="upload_image" value="图片上传" accept="image/jpeg,image/gif,image/png" capture="camera">';
        phoneEle.append(a), $("#upload_image").localResizeIMG({
            width: 800, quality: .8, success: function (a) {
                var b = !0;
                a.height > 1600 && (b = !1, alert("照片最大高度不超过1600像素")), viewImg.find("li").length > 4 && (b = !1, alert("最多上传5张照片")), b && (uploadtipEle.hide(), viewImg.show().append('<li><span class="pic_time"><span class="p_img"></span><em>50%</em></span></li>'), viewImg.find("li:last-child").html('<span class="del"></span><img class="uploadimg" src="' + a.base64 + '"/><input type="hidden" id="file' + imgcount + '" name="fileup[]" value="' + a.clearBase64 + '">'), $(".del").on("click", function () {
                    $("#imglist").find("li").remove(), $("#upload_image").show(), $("#uploadtip").show()
                }), imgcount++)
            }
        })
    }

    var viewImg = $("#imglist"), imgcount = 0, isIOS = navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iphone os/i) || navigator.userAgent.match(/ipod/i), isAndroid = navigator.userAgent.match(/android/i), phoneEle = $(".phone"), uploadtipEle = $("#uploadtip"), uploadweixin = Number(viewImg.data("uploadweixin"));
    uploadweixin ? fileupload() : isIOS ? fileupload() : isAndroid ? window.getdata && (window.getdata.onPickSuccess = function (result, obj) {
        if (obj) {
            var status = !0;
            obj.height > 1600 && (status = !1, alert("照片最大高度不超过1600像素")), status && (uploadtipEle.hide(), viewImg.show().append('<li><span class="pic_time"><span class="p_img"></span><em>50%</em></span></li>'), viewImg.find("li:last-child").html('<span class="del"></span><img class="wh60" src="data:image/jpeg;base64,' + result + '"/><input type="hidden" id="file' + imgcount + '" name="fileup[]" value="' + result + '">'), $(".del").on("click", function () {
                $(this).parent("li").remove(), $("#upload_image").show()
            }), imgcount++)
        } else {
            var imgStr = result.substring(0, result.indexOf(",{")), jsonStr = result.substring(result.indexOf(",{") + 1, result.length + 1);
            jsonStr = eval("(" + jsonStr + ")");
            var status = !0;
            jsonStr.height > 1600 && (status = !1, alert("照片最大高度不超过1600像素")), status && (uploadtipEle.hide(), viewImg.show().append('<li><span class="pic_time"><span class="p_img"></span><em>50%</em></span></li>'), viewImg.find("li:last-child").html('<span class="del"></span><img class="wh60" src="data:image/jpeg;base64,' + imgStr + '"/><input type="hidden" id="file' + imgcount + '" name="fileup[]" value="' + imgStr + '">'), $(".del").on("click", function () {
                $(this).parent("li").remove(), $("#upload_image").show()
            }), imgcount++)
        }
    }, phoneEle.on("click", function () {
        window.getdata.pickfile()
    })) : fileupload()
}());