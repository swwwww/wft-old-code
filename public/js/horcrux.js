!function(a,b,c){"use strict";function d(b){var c=t[b];return a.extend(r.Event.prototype,{selector:b,destroy:h,required:i,one:function(a){return c.once=!0,c.permanent=!!a,this},reset:function(){return c.never=null,c.fired=[],this}})}function e(b){var c,e,f=a.assume(t,b,{queue:[],condition:!1,lock:!1,multiple:!0,occupied:!1,registed:{},fired:[],selector:b,type:"component"});return e={queue:function(a){return f.queue=a,this},run:function(a){return j(b,null,a),this},debounce:function(b,d){return b===!1&&c?this.run=c:b&&(c||(c=this.run),this.run=a.debounce(a.bind(c,this),b,d)),this},condition:function(a){return f.condition=a,this},single:function(){return f.multiple=!1,this},multiple:function(){return f.multiple=!0,this},lock:function(){return f.lock=!0,this},unlock:function(){return f.lock=!1,this},locked:function(){return f.lock},type:"component"},a.extend(e,d(b)),e}function f(b){var c=a.assume(t,b,{queue:[],selector:b,type:"group"}),e=["push","pop","unshift","shift","splice","slice"],f={type:"group",queue:function(a){return c.queue=a,this}};return a.each(e,function(a){f[a]=function(){return p[a].apply(c.queue,arguments),this}}),a.extend(f,d(b)),f}function g(b,c){var e,f=a.assume(t,b,{async:c,core:a.noop,before:[],after:[],selector:b,type:"node"});return e={core:function(a){return f.core=a,this},before:function(){return p.unshift.apply(f.before,arguments),this},after:function(){return p.push.apply(f.after,arguments),this},pack:function(a){return r(a||"!"+b.slice(1)).queue([b])},type:"node"},a.extend(e,d(b)),e}function h(){var a=this.selector;s[a]=t[a]=null}function i(b){return a.isString(b)&&(b=b.split(q)),t[this.selector].required=b,this}function j(b,c,d){function e(a,b){var d;return d=a.call(i),b?i.passing=d:i.results.push(d),c.cutted?(j=c.cutted,!1):!0}function f(b){var d=c.follow;j=c.cutted,j&&1!==j?k.occupied=!1:(c.jump?(c.cutted=c.jump=!1,q=h.length):d?(q++,p.splice.call(h,q,0,d),c.follow=!1):(j||a.every(b.after,e),q++),g())}function g(){var b,d,l,n,o,r=c.offset||0,s=h[q];if(a.isString(s)&&(s=t[s]),!s)return b=c.callback.pop(),void(b?b():m||(k.occupied=!1));if(s.plugins&&a.extend(i,s.plugins),o=a.absence(s.required,c.fulfilled),o.length)return c.fulfilled=c.fulfilled.concat(o),n=[q,0].concat(o),p.splice.apply(h,n),void g();if(r&&(c.offset=0),s.once){if(s.undone)return void s.undone.push(function(){q++,g()});if(s.never||-1!==a.indexOf(k.fired,s.selector))return q++,void g();k.fired.push(s.selector),s.permanent&&(s.never=!0)}return"node"!==s.type?(n=[q,1].concat(s.queue),q+=r,p.splice.apply(h,n),void g()):(i.node=s.selector,i.results=[],a.every(s.before,e),j?void(1===j&&(c.cutted=j=!1,q++,g())):(l=s.async,void(l?(s.once&&(s.undone=[]),d=function(){f(s),s.once&&s.undone&&a.each(s.undone,function(a){a()}),s.undone=!1},s.core.call(i,function(a){i.passing=a,l||d(),l=!1}),l||d(),l=!1):(e(s.core,!0),f(s)))))}var h,i,j,k,m,n,o,q=0,r=!c;k=t[b],o="component"===k.type,h=[k],o||(b=c.component,k=t[b]),m=k.multiple,n=k.condition,k.occupied&&!c||k.lock||n&&!n()||(m||(k.occupied=!0),r&&(c={component:b,fulfilled:[],callback:[]},c.context=l(b,c),d&&d.apply(c.context)),i=c.context,g())}function k(b,c,d){a.isPlainObject(c)?a.extend(b,c):a.isString(c)&&(b[c]=d)}function l(b,c){var d=t[b];return a.extend({register:function(a,b){return k(d.registed,a,b),k(this,a,b),this},unregister:function(b){a.has(d.registed,b)&&(delete d.registed[b],delete this[b])},runtime:function(a,b){return k(this,a,b),this},jump:function(a,b){c.jump=!0,c.offset=b,c.cutted=1,c.callback=[function(){j(a,c)}]},follow:function(a,b){c.follow=a,c.offset=b},cut:function(a){c.cutted=a?1:2},plugin:function(b,c){return k(a.assume(t[this.node],"plugins",{}),b,c),k(this,b,c),this},init:c.init,passing:null},d.registed)}function m(b){var c,d;return"string"==typeof b?(d=v[b],d||(d=v[b]=++w,u[d]={}),c=u[d]):c=a.isPlainObject(b)?b:{},c}var n=("Horcrux"+Math.random()).replace(/\./,""),o=0,p=[],q=/\s+/;a.uncurrying=function(a){return function(){return Function.prototype.call.apply(a,arguments)}},a.assume=function(b,c,d){var e;return e=!a.has(b,c)||a.isNull(b[c])?b[c]=d:b[c]},a.hasOr=function(b,c,d){return a.has(b,c)||a.isNull(b[c])?b[c]:d},a.absence=function(b,c){return a.filter(b,function(b){return-1===a.indexOf(c,b)})};var r=function(b){var c,d;if(c=b.slice(0,1),"!"===c)d=a.assume(s,b,e(b));else if("@"===c)d=a.assume(s,b,f(b));else{if("#"!==c&&"$"!==c)throw new TypeError("wrong selector type!");d=a.assume(s,b,g(b,"$"===c))}return d},s={},t={},u={},v={},w=1;r.Namespace=function(b){var d,e="string"==typeof b,f=m(b);return d=function(b,c){return a.isPlainObject(b)?(a.extend(f,b),f):"undefined"==typeof b?f:("undefined"!=typeof c&&(f[b]=c),f[b])},a.extend(d,{get:function(a){return d(a)},set:function(a,b){return d.call(d,a,b),this},chain:function(){return a(f)},unset:function(){var a;e&&(a=v[b],v[b]=u[a]=c),f=c},reset:function(b){return f=a.isPlainObject(b)?b:{},this}}),d},r.extend=function(){1===arguments.length?a.extend(r,arguments[0]):a.extend.apply(a,arguments)};var x={},y={},z=1;r.Callbacks=function(b,d){a.isPlainObject(b)?(d=b,b=!1):d=d||{};var e,f,g,h,i,j,k,l=!1,m=[],n=[],o=d.valueChain,p=d.unique;return h=b?a.assume(y,b,++z):++z,a.assume(x,h,{add:function(){return n&&(n=n.concat.apply(n,arguments),p&&(n=a.uniq(n)),e=n.length),this},fire:function(){return this.fireWith.apply(this,a(arguments).unshift(this).value()),this},fireWith:function(a,b){var c;if(n&&!i&&!j){for(g&&m.push(f),f=0,g=l=!0;e>f;f++)if(c=n[f],o?b=c.call(a,b):c.call.apply(c,arguments),i||j){j=k;break}f=m.pop(),"undefined"==typeof f&&(j&&(j=k=!1),g=!1)}return this},fired:function(){return l},empty:function(){return n=[],m=[],e=f=0,this},disable:function(){return n=m=c,this},disabled:function(){return!n},remove:function(){var b=arguments;return n&&a.remove(n,function(c,d){var h=a.indexOf(b,c);return-1===h?!1:(g&&(m.length&&a.each(m,function(a,b){a>=d&&(m[b]=a-1)}),f>=d&&f--),e--,!0)}),this},lock:function(){i=!0},unlock:function(){i=!1},locked:function(){return i},stop:function(a){j=!0,k=a}})};var A={};r.Event=function(b,c){return c&&a.isFunction(b)?b.prototype=a.create(r.Event.prototype,b.prototype):a.extend(b,r.Event.prototype),b?b:this instanceof r.Event?this:new r.Event},r.Event.prototype={on:function(b,c,d){var e=a.assume(this,n,++o),f=e+":event:",g=this;return a.each(b.split(q),function(b){var h,i,j=f+b,k=r.Callbacks(j);d&&(h=c,i=e+":once:"+b,c=function(){var b=h[i];h.apply(g,arguments),k.remove(c),a.pull(b,c),a.some(A[i],function(a,b){return h===a?(A[i].splice(b,1),!0):!1}),b.length||(A[i]=[],h[i]=null)},a.assume(A,i,[]).push(h),a.assume(h,i,[]).push(c)),k.add(c)}),this},once:function(a,b){return this.on(a,b,!0),this},off:function(b,c){var d=this[n],e=d+":event:";return a.each(b.split(q),function(b){var f,g=r.Callbacks(e+b),h=d+":once:"+b;c?(f=c[h],f?(a.each(f,function(a){g.remove(a)}),a.pull(f,c),a.pull(A[h],c),f.length||(A[h]=[],c[h]=null)):g.remove(c)):(f=A[h],a.each(f,function(a){a[h]=null}),A[h]=[],g.empty())}),this},trigger:function(){var b=a(arguments);return b.splice(1,0,this),this.triggerWith.apply(this,b.value()),this},triggerWith:function(b){var c=this[n]+":event:",d=a.toArray(arguments);return a.each(b.split(q),function(a){var b=a.split("."),e=b.length-1,f=r.Callbacks(c+a);for(d.shift(),f.fireWith.apply(f,d);e;e--)b.pop(),r.Callbacks(c+b.join(".")).fireWith.apply(f,d)}),this}},r.Event(r),function(){function b(a){return!o[a]}function c(b){var c=e(b.replace(/\\n/,"")),d=c.compile();return function(b){return b=a.extend(b||{},j),d(b,s[c.id])}}function d(){function b(){f=a(g).flatten(!0).uniq().value()}var c,d,e=[],f=[],g=[],h=0;return d={register:function(){[].push.apply(c,arguments),b()},scopePush:function(a){c=a||[],g.push(c),b()},scopePop:function(){g.pop(),b()},text:function(a){""===a||this.printLock||e.push(i.print+'("'+a.replace(/[\r\n]/g,"").replace(l,"\\$1")+'");')},variable:function(a,b){b?e.push(i.print+"("+this.parseVariable(a)+"("+b.join(", ")+"));"):e.push(i.print+"("+this.parseVariable(a)+");")},parseVariable:function(b){if(/^\d+$/.test(b))return b;var c=b.split(".");return-1!==a.indexOf(f,c[0])?b:(c[0]=i.globalVar+'["'+c[0]+'"]',a.each(c,function(a,b){var e,f="";b&&(e=/\[(.*)\]|\d/g.exec(a),e?(e.index&&(f='["'+e.input.slice(0,e.index)+'"]'),c[b]=f+"["+d.parseVariable(e[1]||e[0])+"]"):c[b]='["'+a+'"]')}),c.join(""))},code:function(a){e.push(a),h++},compile:function(){var a;return(a=Function("return function ("+i.globalVar+", "+i.closureVar+") {"+p+"var ret = [];"+e.join("")+'return ret.join("")}'))()},context:{register:function(b,c){var e=d.closureVar;e||(d.code("(function () {"),e=d.closureVar={},s[d.id].push(e),d.closureId=s[d.id].length-1),a.isPlainObject(b)?a.extend(e,b):e[b]=c}}}}function e(b,c){var f,j,l,m=b.split(h.openTag);return c||(c=new d,c.id=t++,s[c.id]=[]),c.text(m.shift()),a.each(m,function(b){var d,m=b.split(h.closeTag),n=m[0],o=k.exec(n),p=o?n.slice(0,o.index):n,r=m[1],s=q[p];if(f)return void(p!==f.closeTag||f.layers?(p===f.openTag?f.layers++:p===f.closeTag&&f.layers&&f.layers--,f.contents.push(b)):(j=f.helper.call(c.context,f.contents.join("{{"))||"",c.closureVar&&c.scopePush(a.map(c.closureVar,function(a,b){return c.code("var "+b+" = "+i.closureVar+"["+c.closureId+']["'+b+'"];'),b})),e(j,c),c.text(r),c.closureVar&&(c.closureVar=null,c.scopePop(),c.code("}());")),f=null));if(o&&(d=n.slice(o.index+o[0].length).split(k)),l=g[p],s)a.isFunction(s)?s.call(c,o?n.slice(o.index+o[0].length):""):c.code(s);else{if(l)return void(f={helper:l,openTag:p,closeTag:"/"+p,contents:[m[1]],layers:0});c.variable(p,d)}c.text(r)}),c}var f=function(a,b){return b?c(a)(b):c(a)},g={},h={openTag:"{{",closeTag:"}}"},i={globalVar:"G",closureVar:"C",print:"__p"},j={_:a},k=/\s+/,l=/(["'\\])/g,m=/[A-Za-z_$](?:[\w$]*\.?|\d+\.?)*/g,n="true false NaN undefined null break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),o={},p=a.reduce({print:function(a){ret.push(a)}.toString()},function(a,b,c){return"var "+a+i[c]+" = "+b+";"},""),q={"if":function(a,c){var d=this;d.code((c?"} else ":"")+"if ("),d.code(a.replace(m,function(a){return b(a)?d.parseVariable(a):a})),d.code(") {")},"/if":"}","else":"} else {",elseif:function(a){q["if"].call(this,a,!0)},each:function(a){var b=a.split(k),c=this.parseVariable(b.shift()),d=this.parseVariable("_"),e=d+".each("+c+", function ($value, $index) {",f=b.length;this.scopePush(["$value","$index"]),1===f&&(e+="var "+b[0]+" = $value;",this.register(b[0])),3===f&&(e+="var "+b[1]+" = $value",e+=", "+b[2]+" = $index;",this.register(b[1]),this.register(b[2])),this.code(e)},"/each":function(){this.code("});"),this.scopePop()},"for":function(a,b){var c,d,e="(function ($index, $iteration) {for (";this.scopePush(["$index","$iteration"]),a=a.split(k),b?(e+="var __i = 0; __i < "+a[0]+"; __i++) {",e+="$iteration = $index = __i;"):(c=this.parseVariable(a[0]),d=this.parseVariable(a[1]),e+="var __start = "+c+"; "+c+" <= "+d+"; "+c+"++) {",e+="$index = "+c+";",e+="$iteration = "+c+"- __start;"),this.code(e)},"/for":function(){this.code("}}());"),this.scopePop()},loop:function(a){q["for"].call(this,m.test(a)?this.parseVariable(a):a,!0)},"switch":function(a){this.code("switch ("+a+") {"),this.printLock=!0},"case":function(b){var c="";this.switchStarted?c="break;":this.switchStarted=!0,b=b.split(k),c=a.reduce(b,function(a,b){return a+"case "+b+":"},c),this.code(c),this.printLock=!1},"default":"break;default:","/switch":function(){this.switchStarted=!1,this.code("break;}")}},s={},t=0;q["/loop"]=q["/for"],a.each(n,function(a){o[a]=!0}),f.settings=h,f.imports=j,f.helper=function(a,b){g[a]=b},r.template=f}(),"function"==typeof define&&define.amd&&define("Horcrux",[],function(){return r}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=r);var B=b.Horcrux,C=b.H;r.noConflict=function(a){return b.H===B&&(b.H=C),a&&b.Horcrux===r&&(b.Horcrux=B),r},b.Horcrux=b.H=r}(_,this);